<!doctype html>
<html>
  <body>
    <h2>WebRTC RTP Stream</h2>

    <div id="video-container"></div>

    <script>
      const pc = new RTCPeerConnection();
      const container = document.getElementById("video-container");
      const ws = new WebSocket("ws://localhost:8080");

      ws.onmessage = async (event) => {
        const data = JSON.parse(event.data);
        if (data.type === "answer") {
          await pc.setRemoteDescription(new RTCSessionDescription(data));
        }
      };

      async function startConnection() {
        const offer = await pc.createOffer();
        await pc.setLocalDescription(offer);

        ws.send(
          JSON.stringify({
            type: "offer",
            sdp: offer.sdp,
          }),
        );

        pc.onicecandidate = (event) => {
          if (event.candidate) {
            ws.send(
              JSON.stringify({
                type: "candidate",
                candidate: event.candidate,
              }),
            );
          }
        };

        pc.ontrack = (event) => {
          const video = document.createElement("video");
          video.srcObject = event.streams[0];
          video.autoplay = true;
          container.appendChild(video);
        };
      }

      ws.onopen = startConnection;
    </script>
  </body>
</html>
